业务员录入价差单
判断是否为正数价差单          （是  bill_type 设为1   否 bill_type 设为2）    


业务员做单发货，引入价差单        不能引入不同bill_type 的价差单

业务员界面的操作分
      
      1. 保存
            -> 新增性保存
                        ―> 保存                        
            -> 修改性保存
      2. 提交船务    --不用修改
      3. 删除
       
1. 保存 
    前台 验证
    1. 每添加一张价差单 检查 该笔价差单的bill_type 是否与已有价差单一致
    2. 本次分摊金额要大于0 且分摊总金额不得大于出货总金额的5% 分摊总金额小于等于剩余总金额的绝对值
    后台验证   
    3. 价差单的剩余金额不等于0   
    4. 计算出来的单台价差 金额要大于0.01   
    后台&数据库操作
    1. 先查出这张出货通知书所引用的所有价差单  把每一张单的占用金额先释放 然后删除该通知书所有的价差单    
    2. 按照前台传入明细 计算占用金额，单台价差 (crm_soshipreq_invoice_diff)新增数据。
    计算逻辑
    算出分摊总金额      算出剩余总金额    算出本次出货金额   
    分摊比例 = 分摊总金额/本次出货金额 
    单台价差 = 报关价s×分摊比例
    单台价差 向下保留两位小数
    if 单台价差 < 0.01  报错
    if 价差单.bill_type =2   
                    单台价差 取反

    占用金额写入  =  分摊金额
    剩余金额写入  =  总金额  - 已使用金额 - 占用金额
    if bill_type =2
                     剩余金额写入  =  总金额  + 已使用金额 + 占用金额

3. 删除
    把该出货通知下的所有价差单占用释放，然后删除明细
      
      



仓库确认界面操作                     
    1.确认发货
    
    后台&数据库操作
    判断是这张单是否为该出货通知的最后一条明细
    if 是
                        回写实际分摊金额，释放占用金额                         
 
回写                        
 实际分摊金额
    按照价差单剩余金额从小到大排序  
        分摊后剩余金额 =价差单【i】. 剩余金额 - 分摊总金额 
        if 分摊后剩余金额 < 0
                                    分摊后剩余金额 =价差单【i】.剩余金额 -|分摊后剩余金额|
        esle                                    
            //TODO                            
                                记录i  beak
    
            